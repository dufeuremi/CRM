<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test des Fonctionnalit√©s</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background: #f5f5f5;
        }
        .test-card {
            background: white;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-card h2 {
            margin-top: 0;
            color: #006EFF;
        }
        .status {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-weight: bold;
            margin-top: 1rem;
        }
        .status.loading { background: #ffc107; color: black; }
        .status.success { background: #4caf50; color: white; }
        .status.error { background: #f44336; color: white; }
        .code {
            background: #f4f4f4;
            padding: 0.5rem;
            border-radius: 4px;
            font-family: monospace;
            overflow-x: auto;
            margin: 0.5rem 0;
        }
        button {
            padding: 0.75rem 1.5rem;
            background: #006EFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            margin: 0.5rem 0.5rem 0 0;
        }
        button:hover { background: #0052cc; }
        .log {
            max-height: 200px;
            overflow-y: auto;
            background: #2d2d2d;
            color: #00ff00;
            padding: 1rem;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <h1>üß™ Test des Fonctionnalit√©s Corrig√©es</h1>
    
    <div class="test-card">
        <h2>1. Bouton "Cr√©er une action"</h2>
        <p>Test de l'event listener du bouton customActionBtn</p>
        <button onclick="testCustomActionButton()">Tester le bouton</button>
        <button onclick="checkCustomActionElements()">V√©rifier les √©l√©ments</button>
        <div id="customActionStatus" class="status loading">En attente...</div>
        <div id="customActionLog" class="log"></div>
    </div>

    <div class="test-card">
        <h2>2. Emails programm√©s dans Rappels</h2>
        <p>Test du chargement de loadScheduledEmails()</p>
        <button onclick="testLoadScheduledEmails()">Tester le chargement</button>
        <button onclick="checkScheduledEmailsElements()">V√©rifier les √©l√©ments</button>
        <div id="scheduledEmailsStatus" class="status loading">En attente...</div>
        <div id="scheduledEmailsLog" class="log"></div>
    </div>

    <div class="test-card">
        <h2>3. Graphique de comparaison</h2>
        <p>Test de la configuration de Chart.js</p>
        <button onclick="testChartConfig()">Tester la config Chart.js</button>
        <button onclick="checkAnalyticsElements()">V√©rifier les √©l√©ments</button>
        <div id="chartStatus" class="status loading">En attente...</div>
        <div id="chartLog" class="log"></div>
    </div>

    <div class="test-card">
        <h2>‚ÑπÔ∏è Informations syst√®me</h2>
        <div class="code" id="systemInfo"></div>
    </div>

    <script>
        // Add log function
        function addLog(elementId, message, isError = false) {
            const logEl = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const color = isError ? '#ff6b6b' : '#00ff00';
            logEl.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logEl.scrollTop = logEl.scrollHeight;
        }

        function setStatus(elementId, status, message) {
            const statusEl = document.getElementById(elementId);
            statusEl.className = `status ${status}`;
            statusEl.textContent = message;
        }

        // Test 1: Custom Action Button
        function checkCustomActionElements() {
            const logId = 'customActionLog';
            document.getElementById(logId).innerHTML = '';
            
            addLog(logId, 'üîç V√©rification des √©l√©ments DOM...');
            
            const btn = document.getElementById('customActionBtn');
            const modal = document.getElementById('customActionModal');
            
            addLog(logId, `customActionBtn: ${btn ? '‚úÖ Trouv√©' : '‚ùå Non trouv√©'}`);
            addLog(logId, `customActionModal: ${modal ? '‚úÖ Trouv√©' : '‚ùå Non trouv√©'}`);
            
            if (btn && modal) {
                setStatus('customActionStatus', 'success', '√âl√©ments OK');
                addLog(logId, '‚úÖ Tous les √©l√©ments sont pr√©sents');
            } else {
                setStatus('customActionStatus', 'error', '√âl√©ments manquants');
                addLog(logId, '‚ùå √âl√©ments manquants - v√©rifier que vous √™tes sur dashboard.html', true);
            }
        }

        function testCustomActionButton() {
            const logId = 'customActionLog';
            document.getElementById(logId).innerHTML = '';
            
            addLog(logId, 'üß™ Test du bouton "Cr√©er une action"...');
            
            const btn = document.getElementById('customActionBtn');
            if (!btn) {
                setStatus('customActionStatus', 'error', 'Bouton non trouv√©');
                addLog(logId, '‚ùå Bouton customActionBtn non trouv√© dans le DOM', true);
                addLog(logId, '‚ÑπÔ∏è Assurez-vous d\'√™tre sur dashboard.html');
                return;
            }
            
            addLog(logId, '‚úÖ Bouton trouv√©');
            addLog(logId, 'Simulation du clic...');
            
            try {
                btn.click();
                setTimeout(() => {
                    const modal = document.getElementById('customActionModal');
                    if (modal && modal.classList.contains('active')) {
                        setStatus('customActionStatus', 'success', 'Test r√©ussi!');
                        addLog(logId, '‚úÖ Modal ouverte avec succ√®s!');
                        addLog(logId, '‚ÑπÔ∏è Fermeture automatique dans 2 secondes...');
                        setTimeout(() => modal.classList.remove('active'), 2000);
                    } else {
                        setStatus('customActionStatus', 'error', 'Modal non ouverte');
                        addLog(logId, '‚ùå La modal ne s\'est pas ouverte', true);
                        addLog(logId, '‚ÑπÔ∏è V√©rifiez la console pour les erreurs');
                    }
                }, 500);
            } catch (error) {
                setStatus('customActionStatus', 'error', 'Erreur');
                addLog(logId, `‚ùå Erreur: ${error.message}`, true);
            }
        }

        // Test 2: Scheduled Emails
        function checkScheduledEmailsElements() {
            const logId = 'scheduledEmailsLog';
            document.getElementById(logId).innerHTML = '';
            
            addLog(logId, 'üîç V√©rification des √©l√©ments DOM...');
            
            const tableBody = document.getElementById('scheduledEmailsTableBody');
            const section = document.getElementById('scheduled-emails-section');
            
            addLog(logId, `scheduledEmailsTableBody: ${tableBody ? '‚úÖ Trouv√©' : '‚ùå Non trouv√©'}`);
            addLog(logId, `scheduled-emails-section: ${section ? '‚úÖ Trouv√©' : '‚ùå Non trouv√©'}`);
            addLog(logId, `loadScheduledEmails fonction: ${typeof loadScheduledEmails !== 'undefined' ? '‚úÖ D√©finie' : '‚ùå Non d√©finie'}`);
            
            if (tableBody && typeof loadScheduledEmails !== 'undefined') {
                setStatus('scheduledEmailsStatus', 'success', '√âl√©ments OK');
                addLog(logId, '‚úÖ Tous les √©l√©ments sont pr√©sents');
            } else {
                setStatus('scheduledEmailsStatus', 'error', '√âl√©ments manquants');
                addLog(logId, '‚ùå √âl√©ments manquants', true);
            }
        }

        function testLoadScheduledEmails() {
            const logId = 'scheduledEmailsLog';
            document.getElementById(logId).innerHTML = '';
            
            addLog(logId, 'üß™ Test du chargement des emails programm√©s...');
            
            if (typeof loadScheduledEmails === 'undefined') {
                setStatus('scheduledEmailsStatus', 'error', 'Fonction non d√©finie');
                addLog(logId, '‚ùå loadScheduledEmails n\'est pas d√©finie', true);
                addLog(logId, '‚ÑπÔ∏è V√©rifiez que script.js est bien charg√©');
                return;
            }
            
            addLog(logId, '‚úÖ Fonction loadScheduledEmails trouv√©e');
            addLog(logId, 'Appel de la fonction...');
            
            try {
                loadScheduledEmails().then(() => {
                    setStatus('scheduledEmailsStatus', 'success', 'Test r√©ussi!');
                    addLog(logId, '‚úÖ Fonction ex√©cut√©e avec succ√®s');
                }).catch(error => {
                    setStatus('scheduledEmailsStatus', 'error', 'Erreur');
                    addLog(logId, `‚ùå Erreur: ${error.message}`, true);
                });
            } catch (error) {
                setStatus('scheduledEmailsStatus', 'error', 'Erreur');
                addLog(logId, `‚ùå Erreur: ${error.message}`, true);
            }
        }

        // Test 3: Chart Config
        function checkAnalyticsElements() {
            const logId = 'chartLog';
            document.getElementById(logId).innerHTML = '';
            
            addLog(logId, 'üîç V√©rification des √©l√©ments...');
            
            const canvas = document.getElementById('comparisonChart');
            addLog(logId, `comparisonChart canvas: ${canvas ? '‚úÖ Trouv√©' : '‚ùå Non trouv√©'}`);
            addLog(logId, `Chart.js charg√©: ${typeof Chart !== 'undefined' ? '‚úÖ Oui' : '‚ùå Non'}`);
            addLog(logId, `AnalyticsManager: ${typeof window.analyticsManager !== 'undefined' ? '‚úÖ D√©fini' : '‚ùå Non d√©fini'}`);
            
            if (canvas && typeof Chart !== 'undefined') {
                setStatus('chartStatus', 'success', '√âl√©ments OK');
                addLog(logId, '‚úÖ Tous les √©l√©ments sont pr√©sents');
            } else {
                setStatus('chartStatus', 'error', '√âl√©ments manquants');
                addLog(logId, '‚ùå √âl√©ments manquants', true);
            }
        }

        function testChartConfig() {
            const logId = 'chartLog';
            document.getElementById(logId).innerHTML = '';
            
            addLog(logId, 'üß™ Test de la configuration Chart.js...');
            
            if (typeof Chart === 'undefined') {
                setStatus('chartStatus', 'error', 'Chart.js non charg√©');
                addLog(logId, '‚ùå Chart.js n\'est pas charg√©', true);
                return;
            }
            
            addLog(logId, '‚úÖ Chart.js est charg√© (version ' + Chart.version + ')');
            
            // Test de configuration simplifi√©e
            const testConfig = {
                type: 'line',
                data: { labels: ['01/01', '02/01', '03/01'], datasets: [] },
                options: {
                    scales: {
                        x: {
                            display: true,
                            title: { display: true, text: 'Date' },
                            ticks: { maxRotation: 45, minRotation: 45 }
                        }
                    }
                }
            };
            
            addLog(logId, 'Configuration test√©e:');
            addLog(logId, '  - Axe X avec rotation 45¬∞: ‚úÖ');
            addLog(logId, '  - Labels de date: ‚úÖ');
            addLog(logId, '  - Pas de type "category": ‚úÖ');
            
            setStatus('chartStatus', 'success', 'Configuration OK');
            addLog(logId, '‚úÖ La configuration du graphique est correcte');
        }

        // System Info
        function loadSystemInfo() {
            const info = document.getElementById('systemInfo');
            const jsFiles = Array.from(document.querySelectorAll('script[src]'))
                .filter(s => !s.src.startsWith('http'))
                .map(s => {
                    const url = new URL(s.src, window.location.href);
                    return url.pathname.split('/').pop();
                });
            
            info.innerHTML = `
                <strong>Navigateur:</strong> ${navigator.userAgent.split(' ').slice(-2).join(' ')}<br>
                <strong>URL actuelle:</strong> ${window.location.href}<br>
                <strong>Fichiers JS locaux charg√©s:</strong><br>
                ${jsFiles.map(f => `  - ${f}`).join('<br>') || '  Aucun'}
            `;
        }

        // Initialize
        loadSystemInfo();
    </script>
</body>
</html>
